<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Careers - Jayasan Infoware Pvt. Ltd.</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>

<body>
<header>
  <div class="brand">
    <div class="logo-wrap">
      <img src="jayasanlogo2021-removebg-preview.png" alt="Jayasan logo" />
    </div>
    <p class="iso-text">An ISO Certified Company</p>
  </div>

  <nav class="desktop">
    <a href="index.html">Home</a>
    <a href="#about">About</a>
    <a href="#services">Services</a>
    <a href="#clients">Clients</a>
    <a href="#map">Presence</a>
    <a href="#contact">Contact</a>
  </nav>
</header>

<section class="form-section">
  <h2>Join Our Team</h2>

  <form id="jobForm">
    <label>Full Name*</label>
    <input type="text" name="user_name" required placeholder="Enter your full name" />

    <label>Email Address*</label>
    <input type="email" name="user_email" required placeholder="Enter your email" />

    <label>Phone Number*</label>
    <input type="tel" name="user_number" required placeholder="Enter your phone number" />

    <label>Position Applying For*</label>
    <select name="position" required>
      <option value="">Select a role</option>
      <option value="Help Desk">Help Desk</option>
      <option value="Network Engineer">Network Engineer</option>
      <option value="IT Support Engineer">IT Support Engineer</option>
      <option value="Printer Engineer">Printer Engineer</option>
    </select>

    <label>Upload Resume (PDF only)*</label>
    <input type="file" id="resumeFile" accept="application/pdf" required />

    <button class="cta" type="submit">Send Application</button>
  </form>

  <p id="successMsg" style="display:none;">âœ… Application submitted successfully!</p>
</section>

<footer id="contact">
  <p><strong>Jayasan Infoware Pvt. Ltd.</strong> â€” Dehradun, Uttarakhand</p>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function() {
  emailjs.init("B9cRp5FtdvX1_JkvJ"); // your EmailJS public key

  const UPLOAD_URL = "https://script.google.com/macros/s/AKfycbygzQllSo3fntEp4vsiZTehHjkR7EKUas7SFZPkM6eF7DzFG9m-BiXKFFQE-lSytBg1xw/exec"; // ðŸ‘ˆ replace with your new Apps Script URL
  const form = document.getElementById("jobForm");
  const resumeFile = document.getElementById("resumeFile");
  const successMsg = document.getElementById("successMsg");
  const sendBtn = form.querySelector("button");

  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    sendBtn.textContent = "Uploading...";
    sendBtn.disabled = true;

    const file = resumeFile.files[0];
    if (!file) {
      alert("Please attach your resume first.");
      sendBtn.textContent = "Send Application";
      sendBtn.disabled = false;
      return;
    }

    try {
      // Convert file to Base64 properly
      const base64 = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });

      // Prepare JSON body
      const uploadPayload = {
        fileName: file.name,
        mimeType: file.type || "application/pdf",
        fileData: base64,
      };

      const uploadResponse = await fetch(UPLOAD_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(uploadPayload),
      });

      const result = await uploadResponse.json();
      if (!result.success) throw new Error(result.error);

      const fileUrl = result.fileUrl;
      sendBtn.textContent = "Sending...";

      const emailData = {
        user_name: form.user_name.value,
        user_email: form.user_email.value,
        user_number: form.user_number.value,
        position: form.position.value,
        resume_link: fileUrl,
      };

      await emailjs.send("service_fb7aklu", "template_1tvlztd", emailData);

      successMsg.style.display = "block";
      form.reset();
      sendBtn.textContent = "Send Application";
      sendBtn.disabled = false;
    } catch (err) {
      alert("Error: " + err.message);
      console.error(err);
      sendBtn.textContent = "Send Application";
      sendBtn.disabled = false;
    }
  });
});
</script>
</body>
</html>
